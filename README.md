# n-choice model simulations

This repository contains the simulation code used for [Newberry et al. 2016
"Assortative mating can impede or facilitate fixation of underdominant
alleles"](https://dx.doi.org/10.1101/042192).

## Building

Building the software requires ocaml, and the ocaml libraries gsl, pcre, and
batteries.  Run `make.sh` to build all executables.
```
./make.sh
```

## Contents

After building each program (i.e., `something.native`) outputs data from a
simulation displayed in a figure.  The data from the runs actually used is also
included in a corresponding (`.tsv`) file.  Each program outputs to stdout.

`endpoints.native` generates the endpoints of 30-generation stochastic runs and
a grid of the expected single-generation changes in genotype frequencies.  The
output is in tab-separated values format with the following columns:
- `type` - either "endpt" or "det" corresponding to simulation or the expected single-generation (deterministic) change in one generation.
- `run` - either "centroid" indicating initialization at 1/3 aa, 1/3 aA, 1/3 AA; or "grid" indicating initialization at a grid of points.
- `pop_size` - Population size
- `cs` - the number of mates surveyed parameter, n, of the n-choice model
- `s` - the selection coefficient
- `f` - the fraction of the population mating each generation
- `aa`, `aA` and `AA` - the genotype frequencies of aa, aA, and AA before the simulation.
- `epaa`, `epaA` and `epAA` - the genotype frequencies of aa, aA, and AA after the simulation.

`fixation_mcmc.native` empirically computes the fixation probability of novel
mutations in the n-choice model under for various parameter values as displayed
in Figures 2 and 3.  To suppress internal state update information, invoke as
`fixation_mcmc.native | grep -v UPD`.  The resulting tab-separated values file
has columns:
- `cs`, `popsize`, `f` - as above
- `s` - the coefficient of selection against heterozygotes
- `wij` - the absolute fitness of each genotype
- `inithom` - the number of initial homozygous individuals
- `inithet` - the number of initial heterozygous indivisuals
- `p` - the initial frequency of the 'a' allele
- `naa` - the number of trials resulting in the fixation of the aa genotype
- `ntrial` - the total number of trials
- `q` - the empirical fixation probability or mean fixation rate
- `err` - 1.96 times the standard deviation of `q`
The original data files `fixation_mcmc.tsv` and `fixation_mcmc-f1.tsv` were
generated by two different runs with different parameter spaces, so the
separation is maintained here.

`assort.native` empirically computes fixation probabilities in the assortative
mating model as seen in Figure 3.  Invoke as `assort.native | grep -v
UPD` to suppress progress information.  The output has columns:
`model` - always "assortmc"
`selfp` - the probability of self-mating at any given mating
`f` - unused, always 0
`popsize`, `s`, `inithom`, `inithet`, `p`, `naa`, `ntrial`, `q`, `err` - as
above

`pi.native` computes fixation probabilities as above for an alternative model
in which males are haploid, as described in the discussion and Figure S1.
Invoke as `pi.native | grep -v UPD` as above.  The output columns are the same
as for `fixation_mcmc`.

`fixation_mcmc_exact.native` differs from `fixation_mcmc.native` only in that
self-mating is disallowed.  This is used to create Figure S2.

## Author

All software was written by Mitchell Newberry <mitchell@silverninja.net> and is
(c) Mitchell Newberry 2016.  Bug reports and comments are welcome.

## License

This software is released under the terms of the GNU General Public License
version 3.  The full text of the license is available from the Free Software
Foundation.

The software is provided as-is, without warranty of any kind, including
merchantability, fitness for any particular use, and noninfringement.  Under no
circumstances shall the author or contributors be liable for any claim,
damages, or other liability, arising from, out of or in connection with the
software or the use or other dealings in the software.
